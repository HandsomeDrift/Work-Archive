# MIRAGE: Multimodal Integration via Representational Alignment using Graphormer and Encoders

## 摘要

心血管疾病尤其是心肌梗死（MI）的准确、及时诊断一直是临床实践中的一个关键挑战。传统的ECG分析方法往往受到其单峰性质的限制，缺乏全面的生理背景。为了解决这一问题，本文提出**MIRAGE**，一种多模态学习框架，将ECG时间序列、ECG图像与实验室生物标志物融合，以提升诊断的准确性与鲁棒性。该框架利用Graphormer对ECG导联间依赖关系进行建模，并采用视觉Transformer从ECG图像中提取形态学特征，两者均通过特征线性调制（FiLM）机制引入实验室特征实现个体化表征。在此基础上，MIRAGE通过Transformer融合模块整合各模态特征，并引入对比学习目标以实现跨模态表征的一致性。在私有数据集和三个公开基准数据集上的实验结果表明，MIRAGE在准确率、F1分数、AUROC和AUPRC等多个指标上均优于现有方法。消融实验进一步验证了各模态和结构组件的有效性。MIRAGE为心血管疾病的个体化诊断提供了临床可解释的路径，也为多模态医学表示学习提供了可扩展的解决方案。

## 引言（Introduction）

心血管疾病（Cardiovascular Diseases, CVDs）仍然是全球范围内的主要死亡原因之一，约占全球死亡总数的三分之一。其中，心肌梗死（Myocardial Infarction, MI，俗称心脏病发作）构成了严重的公共健康挑战。MI通常由于冠状动脉血流受阻而引发，这种阻塞往往是动脉堵塞所致，因而需要迅速且准确的诊断以实现有效干预。及时的检测不仅对于降低死亡率至关重要，同时也有助于减轻如心力衰竭等严重并发症，从而改善患者的整体预后。

心电图（Electrocardiogram, ECG）因其实时监测能力、可及性和稳定的诊断价值而被广泛认可为一种基本的、非侵入性且成本低廉的诊断工具[1]。尽管ECG被广泛应用，传统的ECG分析方法——尤其是依赖单一模态的方法——仍存在显著局限。这类方法易受噪声干扰、难以适应不同患者间的个体差异，并常常缺乏对系统性生理状态的整体理解。近年来，深度学习技术的快速发展极大提升了ECG分类的性能，但现有的大多数模型通常仅依赖于时间序列数据或静态图像中的一种。这种单一模态的建模方式忽视了多模态融合所带来的协同效应，从而在诊断准确性与可解释性方面受到限制。

在此背景下，多模态学习逐渐成为医学诊断中的研究热点。例如，实验室检测提供了ECG无法获取的关键生化背景信息；而ECG图像则体现了结构与形态学特征，为视觉诊断提供重要线索。这些互补模态的集成能够形成更丰富、更具信息性的患者表征，从而支持更精确、个性化的临床评估。例如，Toprak 等人[4]展示了基于高敏肌钙蛋白实验数据训练的深度学习模型在MI分诊中的优越性能，验证了生物标志物在心血管急症诊断中的价值。此外，Kilimci 等人[5]指出，基于Transformer的ECG图像模型可有效识别心脏疾病，进一步证明了视觉线索在自动化诊断中的潜力。

值得注意的是，多模态方法不仅在心血管领域中取得了成果。在其他研究中，Tang 等人[6]提出了一种用于少样本临床问答的元学习ECG-语言模型，强调了跨模态融合对于泛化能力的提升；Holmstrom 等人[7]则指出，ECG信号甚至可以揭示非心脏疾病如慢性肾病等共病情况，进一步体现了ECG潜在的信息价值。这些研究激发了跨越传统波形分析范畴的多模态方法的研究热情。

受到这些临床与方法学进展的启发，本文提出了一种新颖的多模态框架——**MIRAGE**（Multimodal Integration via Representational Alignment using Graphormer and Encoders），该模型专为基于ECG的心血管疾病分类任务设计。MIRAGE协同融合了三类互补的数据模态：反映电活动的12导联ECG时间序列、展现形态学模式的ECG灰度图像，以及体现系统性生化状态的实验室检测数据。

MIRAGE中的架构设计有针对性地解决了关键的临床挑战。例如，传统的时间序列模型难以捕捉12导联ECG数据中潜在的导联间依赖关系，为此本文引入了Graphormer编码器，将每个导联视作图节点，从而显式建模其生理关联性，提升诊断的准确性与可解释性。

与此同时，针对ECG图像的分析部分采用了视觉Transformer（Vision Transformer, ViT），以反映临床实践中对波形形态的视觉评估方法。与传统卷积方法不同，ViT具备全局自注意力机制，能更有效地捕捉如ST段抬高等形态特征[5]。

为进一步增强诊断能力，MIRAGE在两个编码分支中均引入了特征层级线性调制（Feature-wise Linear Modulation, FiLM）机制。该机制利用肌钙蛋白、D-二聚体等实验室生物标志物作为调制信号，动态调整特征表示以反映个体的生理状态[4]，实现具有上下文感知能力的个性化表征提取。

为了综合整合上述多模态信息，MIRAGE设计了一个基于Transformer的融合模块，能够弥合不同模态间的语义差异，建模时间序列、图像与生化信息间复杂的交互。此外，模型还引入了一种对比学习策略，与标准分类任务并行训练，以鼓励跨模态表示的一致性与对齐。

综上，MIRAGE 的主要贡献包括：

- 构建了结合Graphormer与ViT的双分支编码器，有效挖掘ECG的时间与空间信息；
- 引入基于FiLM的生物标志物调制机制，实现个性化、具生理背景的特征提取；
- 构建了一个Transformer驱动的融合策略，实现多模态信息的深度整合；
- 在训练过程中结合了对比学习机制，增强了多模态表示的一致性与鲁棒性。

通过上述创新设计，MIRAGE有效克服了传统单模态ECG方法的诸多限制，为心肌梗死的自动化诊断提供了一种鲁棒、可解释且具临床实用价值的解决方案。

## 相关研究（Related Work）

### A. 心电图分类：进展与挑战

自动化心电图（ECG）分类因其在心血管疾病诊断中的关键作用而受到广泛关注。传统的机器学习方法主要依赖人工特征提取与浅层分类器。随着深度学习的发展，卷积神经网络（CNN）和循环神经网络（RNN）成为主流方法，在MIT-BIH和PTB-XL等标准数据集上取得了显著成绩。近年来，Transformer架构因其对全局时间依赖性的建模能力优越，在ECG任务中也获得越来越多应用【8】。

然而，大多数现有模型依然是**单模态**，仅限于处理原始ECG信号或图像数据。这种单一模态的策略常常忽视了临床诊断的多维信息结构，例如多种数据源与生物标志物的综合判断。例如，Liu 等人【9】提出了基于CNN的急性心肌梗死检测模型，但未引入生化背景；Jafarian 等人【10】研究了浅层与深度模型用于MI定位，但仅依赖于信号形态特征；Lee 等人【11】使用深度学习从ECG中筛查左心室射血分数低的患者，却未探索模态融合。在更广泛的背景下，Kalmady 等人【12】开发了可预测15种心血管疾病的深度学习模型，基于超过160万条ECG记录，展示了ECG在多病种大规模筛查中的潜力【13】。

此外，近期研究也突出了ECG在检测系统性疾病方面的潜力。例如，Holmstrom 等人【7】报道其模型在检测慢性肾病方面表现优异，特别是在年轻人群中效果显著；Khurshid 等人【14】则发现将ECG深度学习与临床特征结合有助于提升房颤风险预测准确性。

------

### B. 图神经网络与Transformer在医学中的应用

图神经网络（GNN）在医学结构化数据建模中展现出巨大潜力。就ECG而言，相较于传统序列模型，GNN能更显式地捕捉导联之间的交互关系。例如，Backhaus 等人【15】利用人工智能对心肌应变进行量化，证明了心脏特征中的空间依赖性具有临床价值。

与此同时，视觉Transformer（ViT）与时间序列Transformer因其建模全局模式的能力而在医疗领域获得关注。Nie 等人【8】将Transformer应用于长时间ECG序列预测中，展示了其在时间建模中的优势；Kilimci 等人【5】则表明ViT变体在ECG图像分类任务中优于传统CNN。但目前，较少研究将GNN与Transformer统一于同一框架之中。MIRAGE 正是通过将Graphormer与ViT整合，联合学习结构与形态特征，填补了这一空白。

------

### C. 心血管诊断中的多模态融合

多模态整合通过融合不同模态的互补信息，有望显著提升诊断的可靠性。已有若干研究探索了将ECG与临床参数结合的路径。例如，Lampert 等人【16】使用深度学习预测室性早搏患者的心肌病，但所用的结构化临床信息较为有限；Yuan 等人【17】证明ECG在预测房颤中的价值，但仅使用窦性心律数据；Wei 等人【18】提出了BMIRC模型，通过掩码自编码器融合ECG时域与频域数据，增强了跨模态表征学习能力。然而，该模型仅限于两种信号模态，并未利用外部临床信息。

Toprak 等人【4】进一步验证了高敏肌钙蛋白（hs-cTn）数据在深度学习心肌梗死预测中的临床意义；Boeddinghaus【19】与 Doudesis 等人【20】也报道了机器学习驱动的ECG解读在急性MI分诊中的优越性，相较于传统规则路径更为准确。Al-Zaiti 等人【21, 22】强调了将ECG特征与临床元数据结合的重要性，可用于风险分层与闭塞性MI识别。类似地，Sun 等人【13】基于160万条加拿大ECG记录，验证了引入实验室信息后模型对群体死亡率预测的能力，说明深度模型可服务于大规模实时风险分层。

MIRAGE在此基础上进一步推进，首次整合ECG时间序列、ECG图像与实验室特征，并引入基于FiLM的病人特征调制机制，从而实现更具个性化与可解释性的表示学习，契合真实临床工作流程。

------

### D. 表示对齐的对比学习方法

对比学习方法在自监督或有监督框架下展现出强大的多模态特征对齐能力。在ECG研究中，对比学习仍属新兴方向。Kowlgi 等人【23】虽将深度学习用于PVC-心肌病检测，但并未涉及跨模态对比对齐；Wei 等人【18】通过引入对比目标提高了跨域泛化能力，为多模态应用奠定了基础。

近期如TimeMAE与TimesURL等模型进一步扩展了对比学习的边界。TimeMAE采用窗口化预测任务的解耦掩码自编码器，提升了时间序列表示的保真度【24】；TimesURL则结合频率-时间增强策略与双重Universum负样本，联合优化对比与重构目标，适用于多种下游任务【25】。

MIRAGE进一步发展这一方向，设计了双向对比损失函数，在ECG时间序列与图像分支之间实现表示对齐，促进了模态间的一致融合，同时保留各自的语义特征。

------

### 小结

MIRAGE的提出受到了以下几方面研究成果的启发并加以拓展：

- ECG分类方法【9–11, 17】；
- 结构建模技术【8, 15】；
- 多模态融合策略【4, 12, 16–22】；
- 对比学习机制【18, 23】。

MIRAGE最终构建了一个统一的、具病人意识的多模态学习框架，用于实现鲁棒的心血管疾病预测。

## 方法（Method）

我们提出了 MIRAGE（Multimodal Integration via Representational Alignment using Graphormer and Encoders），一个统一的多模态学习框架，专为基于 ECG 的疾病预测任务设计。MIRAGE 集成了三种异构模态：12 导联的 ECG 时间序列、ECG 图像，以及实验室检验特征。整体架构包含三大核心组件：

1. 一个带有 FiLM 增强机制的 Graphormer 模块，用于从 ECG 信号中建模时间与导联间的结构模式，同时注入临床上下文；
2. 一个同样通过 FiLM 调制的 Vision Transformer（ViT）图像编码分支，用于提取 ECG 图像中的形态特征；
3. 一个基于 Transformer 编码器的跨模态融合模块，用于联合优化来自多模态的表示。

此外，MIRAGE 引入了对比学习策略，在信号与图像模态之间显式对齐表示，从而获得更稳健、具上下文感知的融合表示，用于最终分类。

本框架的设计旨在解决现有单模态或弱融合模型的不足，实现时间域、空间域及临床特征的深度交互。

------

### A. 数据与特征提取

传统的 ECG 分类模型大多依赖单一模态，如时间序列信号或波形图像，并忽略了来自实验室检测等补充信息的临床洞见。MIRAGE 通过融合以下三种互补模态构建更全面的患者健康表征：

$\mathcal{D}_i = \{ \mathbf{X}_{\text{ECG},i}, \mathbf{X}_{\text{img},i}, \mathbf{x}_{\text{lab},i}, y_i \}$

其中：

- $\mathbf{X}_{\text{ECG},i} \in \mathbb{R}^{12 \times T}$：12 导联 ECG 时间序列；
- $\mathbf{X}_{\text{img},i} \in \mathbb{R}^{1 \times 224 \times 224}$：ECG 灰度图像；
- $\mathbf{x}_{\text{lab},i} \in \mathbb{R}^{D_{\text{lab}}}$：实验室特征向量；
- $y_i \in \{0,1\}$：二分类标签。

每种模态在心血管医学中具有明确的互补性与生理可解释性：

- **ECG 时间序列**：提供高分辨率电生理活动，12 导联分别从不同解剖角度记录，能检测诸如 ST 段抬高、T 波倒置等异常。
- **ECG 图像**：保留波形形态、幅度关系及节律模式，符合临床视觉解读习惯，为模型提供形态结构信息。
- **实验室特征**：反映系统性生理状态，如肌钙蛋白（心肌损伤）、D-二聚体（血栓）、白细胞计数（炎症）等，有助于在 ECG 表现相似时做出区分。

通过集成三模态，MIRAGE 提升了表示的鲁棒性与语义丰富度，同时减少了噪声干扰、数据缺失及模糊波形所带来的误判风险。

MIRAGE 的一项核心创新在于**显式引入实验室数据**作为 FiLM 的调制输入，这是多数公开 ECG 数据集所缺乏的。该机制支持对 ECG 表示进行个性化调整。例如，两名患者 ECG 形态相似但肌钙蛋白水平差异显著，MIRAGE 可据此差异调节表示，从而提高识别准确率。

为实现这种多模态融合，我们构建了一个具备三模态同步采集的数据集，使时间、空间与生化信息在样本级精准对齐，提升模型整体一致性与临床相关性。

------

### B. 时间序列分支：Graphormer 与 FiLM

为捕捉 12 导联 ECG 信号中的时空结构特性，MIRAGE 采用基于 Graphormer 的编码器，并结合 Feature-wise Linear Modulation（FiLM）机制以引入病人特异性上下文。

设 $\mathbf{X}_{\text{ECG}} = [\mathbf{x}_1, \ldots, \mathbf{x}_{12}] \in \mathbb{R}^{12 \times T}$，其中每个 $\mathbf{x}_\ell \in \mathbb{R}^T$ 表示单个导联的时间序列。首先通过线性变换投影至潜在空间：

$\mathbf{h}_\ell^{(0)} = \mathbf{W}_{\text{proj}} \cdot \mathbf{x}_\ell + \mathbf{b}_{\text{proj}}, \quad \forall \ell = 1, \ldots, 12$

接着，引入 Graphormer 模块进行导联间结构建模，其核心为引入可学习的空间偏置 $B \in \mathbb{R}^{12 \times 12}$，用于自注意力机制：

$\text{Attn}(\mathbf{Q}, \mathbf{K}, \mathbf{V}) = \text{softmax}\left( \frac{\mathbf{QK}^\top + \mathbf{B}}{\sqrt{d}} \right) \cdot \mathbf{V}$

为实现个性化调制，MIRAGE 引入 FiLM 层，根据实验室特征生成缩放与偏移参数：

$\gamma = f_\gamma(\mathbf{x}_{\text{lab}}), \quad \beta = f_\beta(\mathbf{x}_{\text{lab}})$

用于调制中间层输出：

$\mathbf{H}^{(l)}_{\text{FiLM}} = \gamma \odot \mathbf{H}^{(l)} + \beta$

最终，我们在序列前加入一个可学习的 [CLS] 向量，经过 Transformer 编码后提取全局表示：

$\mathbf{z}_{\text{ts,cls}} = \text{TransformerEncoder}([\mathbf{h}_{\text{cls}}; \mathbf{H}^{(L)}])$

------

### C. 图像分支：ViT 与 FiLM

图像分支基于 Vision Transformer（ViT）架构，并同样引入 FiLM 调制机制，以在视觉表征中引入实验室上下文。

给定 ECG 灰度图像 $\mathbf{X}_{\text{img}} \in \mathbb{R}^{1 \times H \times W}$，将其划分为 $N$ 个大小为 $P \times P$ 的 patch，并进行展平与线性变换：

$\mathbf{z}_i^{(0)} = \mathbf{W}_{\text{patch}} \cdot \text{Flatten}(\mathbf{X}_i) + \mathbf{b}_{\text{patch}}, \quad i = 1, \ldots, N$

添加可学习的分类 token 与位置编码：

$\mathbf{Z}^{(0)} = [\mathbf{z}_{\text{cls}}; \mathbf{z}_1^{(0)} + \mathbf{e}_1; \ldots; \mathbf{z}_N^{(0)} + \mathbf{e}_N]$

FiLM 调制依旧基于实验室特征生成 $\gamma^{(l)}, \beta^{(l)}$，作用于每一层输出：

$\mathbf{Z}^{(l)}_{\text{FiLM}} = \gamma^{(l)} \odot \mathbf{Z}^{(l)} + \beta^{(l)}$

最终从分类 token 位置提取图像分支表示：

$\mathbf{z}_{\text{img,cls}} = \mathbf{Z}_0^{(L)}$

------

### D. 融合模块：Transformer Encoder

为整合时间序列与图像表示，MIRAGE 引入基于 Transformer 的融合模块，建模模态内与模态间的全局语义依赖。

融合输入包括：

- $\mathbf{z}_{\text{ts,cls}}, \mathbf{z}_{\text{img,cls}} $：两条主分支的全局 token；
- $\mathbf{H}_{\text{ts}}, \mathbf{H}_{\text{img}}$：导联级与图像 patch 级表示。

构建融合 token：

$\mathbf{z}_{\text{global}} = \mathbf{W}_f [\mathbf{z}_{\text{ts,cls}}; \mathbf{z}_{\text{img,cls}}] + \mathbf{b}_f$

拼接所有序列形成输入：

$\mathbf{Z}^{(0)}_{\text{fusion}} = [\mathbf{z}_{\text{global}}; \mathbf{H}_{\text{ts}}; \mathbf{H}_{\text{img}}]$

送入多层 Transformer 进行融合建模：

$\mathbf{Z}^{(L)}_{\text{fusion}} = \text{TransformerEncoder}(\mathbf{Z}^{(0)}_{\text{fusion}})$

提取融合后的主表示：

$\mathbf{z}_{\text{fusion,cls}} = \mathbf{Z}^{(L)}_{\text{fusion}}[0]$

------

### E. 对比学习：模态对齐

为实现模态一致性，MIRAGE 引入对比学习，拉近同一病人在不同模态下的表示，同时区分不同病人样本。

对比损失基于对称 InfoNCE 构建，设 batch 中第 $i$ 个样本的两个模态表示为 $\mathbf{z}_{\text{ts},i}$ 和 $\mathbf{z}_{\text{img},i}$，则损失为：

$\mathcal{L}_{\text{con}} = -\frac{1}{2B} \sum_{i=1}^B \left( \ell_{i}^{\text{ts} \rightarrow \text{img}} + \ell_{i}^{\text{img} \rightarrow \text{ts}} \right)$

其中：

$\ell_{i}^{\text{ts} \rightarrow \text{img}} = \log \frac{\exp(\text{sim}(\mathbf{z}_{\text{ts},i}, \mathbf{z}_{\text{img},i})/\tau)}{\sum_{j=1}^B \exp(\text{sim}(\mathbf{z}_{\text{ts},i}, \mathbf{z}_{\text{img},j})/\tau)}$$\ell_{i}^{\text{img} \rightarrow \text{ts}} = \log \frac{\exp(\text{sim}(\mathbf{z}_{\text{img},i}, \mathbf{z}_{\text{ts},i})/\tau)}{\sum_{j=1}^B \exp(\text{sim}(\mathbf{z}_{\text{img},i}, \mathbf{z}_{\text{ts},j})/\tau)}$

其中 $\text{sim}(\cdot, \cdot)$ 为余弦相似度，$\tau$ 为温度参数。

------

### F. 分类与训练目标

最终的分类由融合表示 $\mathbf{z}_{\text{fusion,cls}}$ 进行：

$\hat{y} = \text{softmax}(\mathbf{W}_{\text{cls}} \cdot \mathbf{z}_{\text{fusion,cls}} + \mathbf{b}_{\text{cls}})$

分类损失 $\mathcal{L}_{\text{cls}}$ 使用交叉熵计算。

总损失函数整合分类与对比损失：

$\mathcal{L}_{\text{total}} = \lambda_{\text{cls}} \cdot \mathcal{L}_{\text{cls}} + \lambda_{\text{con}} \cdot \mathcal{L}_{\text{con}}$

其中 $\lambda_{\text{cls}}, \lambda_{\text{con}}$ 控制两者权重。

------

### G. 方法小结

MIRAGE 构建了一个融合时间序列 ECG、图像 ECG 与实验室特征的统一多模态框架。通过结合模态特定编码器、FiLM 调制与 Transformer 融合模块，以及对比学习机制，模型能够捕捉复杂的时空-生理交互特征，提升心肌梗死诊断的准确性、鲁棒性与临床可解释性。

## 实验设计

### 数据预处理

为提升特征提取的鲁棒性与分类性能的可靠性，我们对所有 ECG 数据集执行了系统化的预处理流程，以消除常见伪差并统一数据格式。

**去噪。** 原始 ECG 信号通常受到噪声、基线漂移和运动伪影等干扰的影响，这些因素会对分类准确性产生负面影响 [30]。为缓解上述干扰，我们采用了截止频率为 0.05–75 Hz 的巴特沃思带通滤波器 [31]，在保留关键生理信息的同时有效抑制无关噪声。

**下采样。** 所有 ECG 信号从原始的 500 Hz 降采样至 100 Hz，以显著降低计算复杂度，同时保留足够的诊断信息。这一做法与 ECG 建模相关的既有研究结果一致 [14, 32]。

**规范化。** 为缓解潜在的分布偏移效应，我们对每条 ECG 记录的每个导联分别进行了实例归一化处理 [33]。此操作有助于统一不同样本间的振幅尺度，从而提升模型的泛化能力 [10]。

**标签重建。** 原始标注中分配给每条 ECG 记录的 SNOMED-CT 编码被转换为离散的类别标签。转换完成后，宁波、PTB-XL 和 Chapman 数据集分别包含 25、22 和 19 个类别。值得注意的是，这些数据集普遍存在类别不平衡问题，具体表现为部分类别中正负样本数量存在显著差异，以及不同类别间样本总数的分布不均。

通过上述预处理流程，我们显著提升了数据输入的规范性和质量，为后续的特征建模与分类任务奠定了坚实基础。

### 对比方法

为全面评估所提出的 MIRAGE 框架的有效性，我们选取了多种具有代表性的时间序列自监督与对比学习方法作为对比。

- **TF-C（Temporal Feature Contrast）** [1]：该方法通过对时间序列不同时间段的表示进行对比，提取具有区分性的时序特征，旨在同时捕捉全局和局部的时间动态特征，适用于多变量时间序列的建模。
- **TS-TCC（Time-Series Temporal Contrastive Coding）** [2]：该方法基于构造同一时间序列的多个时序增强视图，并在其间施加对比约束，从而学习时间不变性，有效提升模型在不同时间结构下的鲁棒性。
- **CPC（Contrastive Predictive Coding）** [3]：该方法通过最大化当前上下文表示与未来潜在表示之间的互信息，鼓励模型保留序列中的预测结构，从而提取具有高度时序关联性的特征。
- **TimesURL（Time-Series Unsupervised Representation Learning）** [4]：这是一个集成式自监督学习框架，融合了上下文预测、序列重排等多种预训练任务，旨在学习可迁移的时间序列通用表示。
- **SimMTM（Simple Masked Time-Series Modeling）** [5]：SimMTM 随机遮蔽序列片段并重建它们，通过这种方式学习时间依赖结构，兼具模型结构简单和预训练有效性。
- **PatchTST** [6]：该方法基于纯Transformer架构，通过将时间序列划分为不重叠的片段（patch），并在片段之间应用全局自注意力机制，擅长建模长程依赖关系，在预测任务中表现优异。
- **TimeMAE** [7]：这是一个面向时间序列数据的掩码自编码器模型，通过随机遮蔽序列片段并进行重构以学习潜在表示，已在多个时间序列迁移学习任务中展现出竞争力。

上述方法为本研究提供了多种强基线模型，用于在相同的下游心电图分类任务中与 MIRAGE 进行比较。

### 实现细节

本模型使用 PyTorch 框架实现，并在单张 RTX 4090 GPU 上进行训练。训练过程中，批量大小设置为 32，数据加载使用 4 个工作线程。训练总轮数为 50，初始学习率设为 $3.26 \times 10^{-5}$。我们采用线性 warm-up 策略，warm-up 阶段占总训练步数约 13%，后续则使用余弦退火进行学习率衰减。

优化器选用 AdamW，损失函数由两个部分组成：监督分类损失与跨模态对比对齐损失。两项损失的权重系数分别设置为 $\lambda_{\text{cls}} = 1.0$ 与 $\lambda_{\text{contrast}} = 0.445$，对比学习中的温度参数设为 0.1。

模型中的融合模块采用基于 Transformer 的编码器结构，包含 3 层，每层配备 4 个注意力头，前馈层维度为 1692，融合后表示维度为 256。

考虑到临床数据中存在一定程度的类别不平衡问题，我们在训练过程中引入类别权重机制，以提升模型优化的稳定性与评价指标的可信度。

所有对比方法均按照原始论文提供的推荐超参数配置进行训练，以保证实验对比的公平性。

## 实验结果

### SDU-SH 数据集上的实验结果

为全面评估 MIRAGE 在真实临床场景中的诊断能力，我们在 SDU-SH 数据集上开展了系统性实验。该数据集包含配对的 12 导联 ECG 记录与相应的实验室检验结果。为了保证比较的充分性，我们选取了一系列具有代表性的强基线模型作为对照，包括监督学习的 Transformer 变体（TF-C₁、TF-C_R）、时间序列对比学习方法（TS-TCC₁、CPC）、主流自监督学习框架（TimesURL、SimMTM_D、SimMTM_Q），以及最新的时间序列 Transformer 模型（PatchTST、TimeMAE）。

在准确率（ACC）、F1 分数、AUROC 和 AUPRC 四项评估指标中，MIRAGE 均取得了领先表现，超越了所有基线模型。尤其是在 F1 分数与 AUPRC 上的显著提升，展现了其优越的分类能力以及在处理类别不平衡问题方面的强大鲁棒性。与表现最强的基线模型（如 TS-TCC₁）相比，MIRAGE 在 AUROC 与 AUPRC 指标上展现出明显优势，说明其在区分正负样本方面具有更高的判别力。

尽管部分基线模型（如 TS-TCC₁ 和 CPC）在个别指标上表现不俗，但它们缺乏对个体生理特征的建模能力，也未显式融合多模态信息。相比之下，MIRAGE 借助实验室指标的早期 FiLM 调制、模态专属编码器和基于对比学习的跨模态对齐机制，有效建模了多模态 ECG 数据中的患者异质性与微妙诊断信号。

整体结果表明，MIRAGE 不仅在与当前先进模型的对比中表现出色，更在多模态临床数据场景中展现出独特优势。其结构设计有助于实现精准、个性化的诊断预测，凸显了其临床应用价值。

### 公共数据集上的实验结果

为进一步验证 MIRAGE 在不同真实场景中的泛化能力，我们在三个公开 ECG 数据集——宁波、PTB-XL 和 Chapman 上开展了对比实验。与 SDU-SH 数据集不同，这些公开数据集不包含实验室检验指标，因此我们在实验中使用了移除实验室特征输入与 FiLM 调制模块后的 MIRAGE 简化版本，以评估该框架在模态不完整情况下的鲁棒性。

即使在缺少实验室模态的前提下，MIRAGE 仍在所有数据集上表现出稳健且具有竞争力的性能。在宁波数据集上，MIRAGE 在准确率与 F1 分数上均取得最高，且 AUROC 表现与最佳模型持平。在 PTB-XL 数据集上，虽然缺乏实验室信息，MIRAGE 依然在准确率和各项指标上保持了稳定表现。在 Chapman 数据集上，MIRAGE 同样在准确率与 F1 分数上取得领先，展现了良好的预测能力与跨数据集的泛化能力。

需要指出的是，部分基线方法采用了复杂的自监督预训练策略或针对性的对比学习目标。但即便在模态缺失的条件下，MIRAGE 仍能凭借其结构优势——包括模态特异性编码器与结构化融合机制——提取鲁棒、可迁移的 ECG 特征表示。

综上所述，这组实验结果进一步验证了 MIRAGE 框架在模态不完整条件下依然能够保持较高分类性能，体现出其在多样化 ECG 分类场景中的实用性与适应性。

### 消融实验

为了全面评估 MIRAGE 框架中各个组件的具体贡献，我们系统性地设计并实施了一系列消融实验，分别针对模态整合与结构设计两个维度展开。这些实验帮助我们深入理解各个模块在提升模型性能与鲁棒性方面的作用。

去除实验室检验特征、ECG 图像和ECG 时间序列的模型变体分别表示为“w/o Laboratory”，“w/o IMG”，"w/o TS"，完整模型则表示为“Full Model”。此外，我们还研究几种不同的模型结构，移除对比学习的模型变体记作"w/o Contrast"，移除跨模态融合模块的记作"w/o Shared"。同时，我们还研究了在模态融合阶段注入实验室检验特征，以及仅使用跨模态融合模块的模型变体，分别记作"Late-Concat"和"All-Shared"。

我们首先考察了多模态数据引入的作用，通过逐一移除不同模态，观察模型性能的变化。当去除实验室检验特征——这一模块通过 FiLM 调制机制提供个体化的生理背景信息——模型整体性能出现明显下降。这一结果强调了系统性生物标志物在提升个体化建模能力和分类准确性方面的重要作用。类似地，当模型仅使用 ECG 时间序列或仅使用 ECG 图像作为输入时，其性能相较于完整的多模态模型均有明显退化。尤其是在缺失时间序列数据的情况下，性能下降更为显著，表明电生理动态特征在心血管疾病建模中具有不可替代的价值；而图像模态的剔除，则进一步证明了形态学特征在诊断决策中的重要性。两种模态的信息相互补充，共同构建了更加全面的诊断依据。

接下来，我们评估了关键结构模块对整体性能的影响。在移除对比学习目标后，模型在模态之间的表示一致性与对齐能力明显减弱，导致融合表示不够连贯，从而降低了最终的分类能力。此外，将深度融合模块替换为简单的拼接策略也会引发性能下降，表明结构化的跨模态交互机制对于有效捕捉模态间复杂依赖关系至关重要。我们还发现，若将实验室特征延后至融合阶段再拼接，而非通过 FiLM 在早期引导表示学习，也会显著削弱模型的泛化能力与诊断效果。这进一步验证了个性化生理信息应尽早介入建模过程的重要性。最后，当使用统一的共享编码器替代为每种模态专门设计的分支结构时，模型性能下降最为剧烈，清晰地表明模态特异性结构在处理异构医学数据时的必要性。

总体而言，消融实验结果表明，MIRAGE 的诊断能力与鲁棒性并非依赖于某一单一模块，而是得益于多模态输入、FiLM 调制实现的个体化建模、基于 Transformer 的结构化融合机制，以及对比学习驱动下的模态表示对齐等多个模块之间的有机协同。各模块在增强模型性能、提升临床解释性与泛化能力方面均发挥着独立而关键的作用。

### 参数敏感性分析

为了探究关键超参数对模型性能的影响，我们围绕训练目标中的两个核心因素进行了敏感性分析：对比损失中的温度参数 $\tau$ 和分类损失与对比损失之间的权重系数 $\lambda_{\text{con}}$。

**温度参数 $\tau$：**
 实验结果表明，模型对对比损失中的温度缩放因子较为敏感。当 $\tau$ 值较小时（如 $\tau = 0.05$），相似度分布过于尖锐，可能导致对比对的过拟合，从而影响模型性能。相反，当 $\tau$ 值过大（如 $\tau = 1.0$）时，分布趋于平坦，导致对比学习中的判别能力下降。实验显示，模型在 $\tau$ 取值约为 0.1 到 0.2 时可取得最佳的 F1 分数，说明此区间在对比学习强度与泛化能力之间达到了较好的平衡。

**对比损失权重 $\lambda_{\text{con}}$：**
 我们进一步分析了对比损失在总损失中所占比重的变化对模型性能的影响。当 $\lambda_{\text{con}} = 0$ 时，即模型完全依赖监督分类信号，缺乏模态对齐的驱动，导致融合特征表达能力不足。随着 $\lambda_{\text{con}}$ 的增加，模型的模态间协同效果得到增强，性能持续提升。然而，当权重过大（如 $\lambda_{\text{con}} = 1.0$）时，对比损失的主导地位可能削弱分类目标的作用，造成性能小幅下降。综合结果表明，$\lambda_{\text{con}}$ 在 0.3 至 0.5 区间时，模型性能最为稳定且优越。

该实验验证了在基于对比学习的多模态模型中，超参数调节对性能提升具有重要作用。合理设定 $\tau$ 和 $\lambda_{\text{con}}$ 不仅有助于提高分类准确性，还能增强模态间表示对齐的鲁棒性，从而提升模型在临床预测任务中的泛化能力与稳定性。

## V. 结论

本研究提出了 MIRAGE，一个面向心血管疾病预测任务的多模态融合框架，致力于提升基于心电图的诊断准确性与可解释性。通过整合 ECG 时间序列、ECG 图像与实验室检验结果，MIRAGE 有效弥补了传统单模态方法在信息覆盖与临床语义上的不足，提供了一种更具整体性与临床价值的患者表征方式。

该框架融合了多个关键设计创新。首先，采用模态专属的编码器，有效捕捉 ECG 时间序列与图像数据各自独特的特征表达。其次，引入基于 FiLM 的特征调制机制，将实验室检验中的个体化生理信息注入表示学习过程，从而实现个性化的表征建模。此外，Transformer 融合模块用于建模模态间的深层交互关系，而对比学习策略则进一步增强了不同模态之间的语义一致性与表示对齐能力。

大量实验证明，MIRAGE 在多个性能指标上均显著优于基线模型与消融变体，验证了模态整合、早期生理调制与结构化跨模态融合在提高诊断性能与模型稳健性方面的重要价值。

未来研究可探索多个潜在方向。引入更多模态的信息——如临床文本、心脏影像（如超声心动图）或基因组数据——有望进一步丰富患者表征。此外，将该框架扩展至多标签或多任务学习场景，可拓展其在更复杂临床诊断任务中的应用潜力。进一步探究模型表征的可解释性，并评估其在实际临床流程中的部署效果，也将是推动其临床转化的重要方向。

总体而言，本研究展示了多模态学习在医学人工智能领域的广阔前景，并为推动心血管疾病智能诊断的发展提供了一个具备可扩展性与适应性的技术基础。









```
@article{xie2021multi,
  title={A multi-stage denoising framework for ambulatory ECG signal based on domain knowledge and motion artifact detection},
  author={Xie, Xiaoyun and Liu, Hui and Shu, Minglei and Zhu, Qing and Huang, Anpeng and Kong, Xiangpu and Wang, Yinglong},
  journal={Future Generation Computer Systems},
  volume={116},
  pages={103--116},
  year={2021},
  publisher={Elsevier}
}
```

```
@article{krasteva2016real,
  title={Real-time arrhythmia detection with supplementary ECG quality and pulse wave monitoring for the reduction of false alarms in ICUs},
  author={Krasteva, Vessela and Jekova, Irena and Leber, Remo and Schmid, Ramun and Ab{\"a}cherli, Roger},
  journal={Physiological measurement},
  volume={37},
  number={8},
  pages={1273},
  year={2016},
  publisher={IOP Publishing}
}
```

```
@article{martin2021real,
  title={Real-time frequency-independent single-Lead and single-beat myocardial infarction detection},
  author={Martin, Harold and Morar, Ulyana and Izquierdo, Walter and Cabrerizo, Mercedes and Cabrera, Anastasio and Adjouadi, Malek},
  journal={Artificial intelligence in medicine},
  volume={121},
  pages={102179},
  year={2021},
  publisher={Elsevier}
}
```

